(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{naEU:function(e,t,o){"use strict";o.r(t),o.d(t,"MapModule",function(){return Y});var r=o("ofXK"),i=o("tyNb");class n{}var a=o("fXoL"),c=o("3Pt+"),l=o("S3li"),s=o("cxbk"),b=o("tk/3");let u=(()=>{class e{constructor(e){this.http=e}creerFavoris(e){const t={headers:new b.c({"Content-Type":"application/json"})};return this.http.post(`${s.a.baseUrl}${s.a.createFavoris}`,{communeId:e.communeId,meteo:e.meteo,air:e.air,choixDateDebut:e.choixDateDebut,choixDateFin:e.choixDateFin,utilisateurId:e.utilisateurId},t)}}return e.\u0275fac=function(t){return new(t||e)(a.bc(b.a))},e.\u0275prov=a.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=o("kmnG"),d=o("qFsG"),h=o("QibW"),p=o("iadO"),f=o("bTqV");function v(e,t){1&e&&(a.Ub(0,"mat-error"),a.Ic(1,"Invalid start date "),a.Tb())}function g(e,t){1&e&&(a.Ub(0,"mat-error"),a.Ic(1,"Invalid end date"),a.Tb())}let T=(()=>{class e{constructor(e,t,o){this.mapService=t,this.favorisService=o,this.favoris=new n,this.formulaireFavoris=e.group({indicateur:[],dateDebut:[],departement:[]})}ngOnInit(){this.mapService.onPolluant()}validFavoris(){let e=new n;this.convertPropertiesToBoolean(e),this.feedFavoris(e),this.favorisService.creerFavoris(e).subscribe(e=>console.log("success ",e),e=>console.log("error ",e))}convertPropertiesToBoolean(e){return"air"===this.formulaireFavoris.get("indicateur").value?(e.air=!0,e.meteo=!1):(e.air=!1,e.meteo=!0),e}feedFavoris(e){return e.choixDateDebut=this.formulaireFavoris.get("dateDebut").value,e.choixDateFin=this.formulaireFavoris.get("dateFin").value,e.communeId=JSON.parse(localStorage.getItem("commune")).idCommune,e.utilisateurId=JSON.parse(localStorage.getItem("utilisateur")).id,e}}return e.\u0275fac=function(t){return new(t||e)(a.Ob(c.d),a.Ob(l.a),a.Ob(u))},e.\u0275cmp=a.Ib({type:e,selectors:[["app-auth"]],decls:35,vars:7,consts:[[1,"container-fluid"],[1,"example-container"],["appearance","fill"],["matInput","","placeholder","Ex : Montpellier",1,"form-control"],[3,"formControl"],["name","meteo","value","meteo"],["name","air","value","air"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"formControl"],["matEndDate","","placeholder","End date",3,"formControl"],[2,"color","rgb(255, 136, 0)",3,"for"],["picker",""],[4,"ngIf"],[1,"text-center"],["mat-stroked-button","","color","warn","type","submit",3,"click"]],template:function(e,t){if(1&e&&(a.Ub(0,"div",0),a.Ub(1,"h3"),a.Ub(2,"b"),a.Ic(3,"Cr\xe9er un relev\xe9 personalis\xe9"),a.Tb(),a.Tb(),a.Ub(4,"form"),a.Ub(5,"div",1),a.Ub(6,"mat-form-field",2),a.Ub(7,"mat-label"),a.Ic(8,"Nom de la ville"),a.Tb(),a.Pb(9,"input",3),a.Tb(),a.Tb(),a.Pb(10,"br"),a.Ub(11,"div"),a.Ub(12,"label"),a.Ic(13,"Indicateur:"),a.Tb(),a.Pb(14,"br"),a.Ub(15,"mat-radio-group",4),a.Ub(16,"mat-radio-button",5),a.Ic(17,"Meteo"),a.Tb(),a.Ub(18,"mat-radio-button",6),a.Ic(19,"Air"),a.Tb(),a.Tb(),a.Tb(),a.Pb(20,"br"),a.Ub(21,"mat-form-field",2),a.Ub(22,"mat-label"),a.Ic(23,"Entrez la p\xe9riode"),a.Tb(),a.Ub(24,"mat-date-range-input",7),a.Pb(25,"input",8),a.Pb(26,"input",9),a.Tb(),a.Pb(27,"mat-datepicker-toggle",10),a.Pb(28,"mat-date-range-picker",null,11),a.Gc(30,v,2,0,"mat-error",12),a.Gc(31,g,2,0,"mat-error",12),a.Tb(),a.Tb(),a.Ub(32,"div",13),a.Ub(33,"button",14),a.ec("click",function(){return t.validFavoris()}),a.Ic(34," Valider "),a.Tb(),a.Tb(),a.Tb()),2&e){const e=a.wc(29);a.Bb(15),a.oc("formControl",t.formulaireFavoris.controls.indicateur),a.Bb(9),a.oc("rangePicker",e),a.Bb(1),a.oc("formControl",t.formulaireFavoris.controls.dateDebut),a.Bb(1),a.oc("formControl",t.formulaireFavoris.controls.dateFin),a.Bb(1),a.oc("for",e),a.Bb(3),a.oc("ngIf",t.formulaireFavoris.controls.dateDebut.hasError("matStartDateInvalid")),a.Bb(1),a.oc("ngIf",t.formulaireFavoris.controls.dateFin.hasError("matEndDateInvalid"))}},directives:[c.u,c.m,c.n,m.c,m.f,d.b,h.b,c.l,c.f,h.a,p.a,p.f,c.c,p.e,p.d,p.b,r.m,f.a,m.b],styles:["mat-radio-button[_ngcontent-%COMP%]{margin:1em}label[_ngcontent-%COMP%], mat-label[_ngcontent-%COMP%]{color:#f44336}"]}),e})();var I=o("0IaG"),U=o("DysN");function C(e,t){1&e&&(a.Ub(0,"mat-error"),a.Ic(1,"Invalid start date "),a.Tb())}function S(e,t){1&e&&(a.Ub(0,"mat-error"),a.Ic(1,"Invalid end date "),a.Tb())}let k=(()=>{class e{constructor(e,t,o,r){this.mapService=t,this.dialog=o,this.authServ=r,this.relevesPolluants=[],this.infosFromBack=!1,this.displayedColumns=["nom","valeur","dateDebut","dateFin"],this.columnsToDisplay=this.displayedColumns.slice(),this.formulaireHistorique=e.group({commune:[],dateDebut:[],dateFin:[]})}ngOnInit(){this.authServ.utilisateurConnecteObs.subscribe(e=>{e.estAnonyme()||(this.communeSelected=JSON.parse(localStorage.getItem("commune")),this.nomCommuneSelected=this.communeSelected.nomCommune)})}subscribeToHistoriquePolluant(){this.mapService.getHistoriquePolluantStation(JSON.parse(localStorage.getItem("commune")).idCommune,this.formulaireHistorique.get("dateDebut").value,this.formulaireHistorique.get("dateFin").value).subscribe(e=>this.relevesPolluants=e,e=>console.log("erreur ",e))}}return e.\u0275fac=function(t){return new(t||e)(a.Ob(c.d),a.Ob(l.a),a.Ob(I.a),a.Ob(U.a))},e.\u0275cmp=a.Ib({type:e,selectors:[["app-auth"]],decls:37,vars:8,consts:[[1,"container","row"],["id","form",1,"span6"],[1,"container-fluid"],[1,"example-container"],["appearance","fill"],["matInput","","placeholder","Ex : Montpellier",1,"form-control",3,"value"],[3,"formControl"],["name","meteo","value","meteo"],["name","air","value","air"],[3,"rangePicker"],["matStartDate","","placeholder","Date d\xe9but",3,"formControl"],["matEndDate","","placeholder","Date fin",3,"formControl"],[2,"color","rgb(255, 136, 0)",3,"for"],["picker",""],[4,"ngIf"],[1,"text-center"],["mat-stroked-button","","color","warn","type","submit",3,"click"]],template:function(e,t){if(1&e&&(a.Ub(0,"div",0),a.Ub(1,"div",1),a.Ub(2,"div",2),a.Ub(3,"h3"),a.Ub(4,"b"),a.Ic(5,"Consulter l'historique des polluants"),a.Tb(),a.Tb(),a.Ub(6,"form"),a.Ub(7,"div",3),a.Ub(8,"mat-form-field",4),a.Ub(9,"mat-label"),a.Ic(10,"Nom de la ville"),a.Tb(),a.Pb(11,"input",5),a.Tb(),a.Tb(),a.Pb(12,"br"),a.Ub(13,"div"),a.Ub(14,"label"),a.Ic(15,"Indicateur:"),a.Tb(),a.Pb(16,"br"),a.Ub(17,"mat-radio-group",6),a.Ub(18,"mat-radio-button",7),a.Ic(19,"Meteo"),a.Tb(),a.Ub(20,"mat-radio-button",8),a.Ic(21,"Air"),a.Tb(),a.Tb(),a.Tb(),a.Pb(22,"br"),a.Ub(23,"mat-form-field",4),a.Ub(24,"mat-label"),a.Ic(25,"Entrez la p\xe9riode"),a.Tb(),a.Ub(26,"mat-date-range-input",9),a.Pb(27,"input",10),a.Pb(28,"input",11),a.Tb(),a.Pb(29,"mat-datepicker-toggle",12),a.Pb(30,"mat-date-range-picker",null,13),a.Gc(32,C,2,0,"mat-error",14),a.Gc(33,S,2,0,"mat-error",14),a.Tb(),a.Tb(),a.Ub(34,"div",15),a.Ub(35,"button",16),a.ec("click",function(){return t.subscribeToHistoriquePolluant()}),a.Ic(36," Valider "),a.Tb(),a.Tb(),a.Tb(),a.Tb(),a.Tb()),2&e){const e=a.wc(31);a.Bb(11),a.pc("value",t.nomCommuneSelected),a.Bb(6),a.oc("formControl",t.formulaireHistorique.controls.indicateur),a.Bb(9),a.oc("rangePicker",e),a.Bb(1),a.oc("formControl",t.formulaireHistorique.controls.dateDebut),a.Bb(1),a.oc("formControl",t.formulaireHistorique.controls.dateFin),a.Bb(1),a.oc("for",e),a.Bb(3),a.oc("ngIf",t.formulaireHistorique.controls.dateDebut.hasError("matStartDateInvalid")),a.Bb(1),a.oc("ngIf",t.formulaireHistorique.controls.dateFin.hasError("matEndDateInvalid"))}},directives:[c.u,c.m,c.n,m.c,m.f,d.b,h.b,c.l,c.f,h.a,p.a,p.f,c.c,p.e,p.d,p.b,r.m,f.a,m.b],styles:["mat-radio-button[_ngcontent-%COMP%]{margin:1em}label[_ngcontent-%COMP%], mat-label[_ngcontent-%COMP%]{color:#f44336}#form[_ngcontent-%COMP%]{margin-right:3rem}"]}),e})();class P{constructor(e){Object.assign(this,e)}}var M=o("wZkO"),y=o("Wp6s");function O(e,t){if(1&e&&(a.Sb(0),a.Ub(1,"tr"),a.Ub(2,"th",9),a.Ic(3),a.Tb(),a.Ub(4,"td"),a.Ic(5),a.Tb(),a.Ub(6,"td"),a.Ic(7),a.Tb(),a.Ub(8,"td"),a.Ic(9),a.jc(10,"date"),a.jc(11,"date"),a.Tb(),a.Ub(12,"td"),a.Ic(13),a.jc(14,"date"),a.jc(15,"date"),a.Tb(),a.Tb(),a.Rb()),2&e){const e=t.$implicit,o=t.index;a.Bb(3),a.Jc(o+1),a.Bb(2),a.Jc(e.nom),a.Bb(2),a.Jc(e.valeur),a.Bb(2),a.Lc("",a.lc(10,7,e.dateDebut,"d MMM YYYY")," \xe0 ",a.lc(11,10,e.dateDebut,"hh:mm"),""),a.Bb(4),a.Lc("",a.lc(14,13,e.dateFin,"d MMM YYYY")," \xe0 ",a.lc(15,16,e.dateFin,"hh:mm"),"")}}function D(e,t){if(1&e){const e=a.Vb();a.Ub(0,"button",6),a.ec("click",function(){return a.yc(e),a.ic(2).openFavoris()}),a.Ic(1,"Ajouter un favoris"),a.Tb()}}function B(e,t){if(1&e){const e=a.Vb();a.Sb(0),a.Ub(1,"mat-card",2),a.Ub(2,"mat-card-header"),a.Ub(3,"mat-card-title"),a.Ic(4),a.Tb(),a.Ub(5,"mat-card-subtitle"),a.Ic(6),a.Tb(),a.Tb(),a.Ub(7,"mat-card-content"),a.Ub(8,"table",3),a.Ub(9,"thead"),a.Ub(10,"tr"),a.Ub(11,"th",4),a.Ic(12,"Temperature (\xb0C)"),a.Tb(),a.Ub(13,"th",4),a.Ic(14,"Cumul de pluie"),a.Tb(),a.Ub(15,"th",4),a.Ic(16,"Vitesse Moyenne du vent"),a.Tb(),a.Ub(17,"th",4),a.Ic(18,"Date"),a.Tb(),a.Tb(),a.Tb(),a.Ub(19,"tbody"),a.Sb(20),a.Ub(21,"tr"),a.Ub(22,"td"),a.Ic(23),a.Tb(),a.Ub(24,"td"),a.Ic(25),a.Tb(),a.Ub(26,"td"),a.Ic(27),a.Tb(),a.Ub(28,"td"),a.Ic(29),a.jc(30,"date"),a.Tb(),a.Tb(),a.Rb(),a.Tb(),a.Tb(),a.Tb(),a.Ub(31,"mat-card-actions"),a.Ub(32,"button",6),a.ec("click",function(){return a.yc(e),a.ic(2).openHistorique()}),a.Ic(33,"Voir l'historique des informations"),a.Tb(),a.Ub(34,"button",6),a.ec("click",function(){return a.yc(e),a.ic(2).openFavoris()}),a.Ic(35,"Ajouter un favoris"),a.Tb(),a.Tb(),a.Tb(),a.Rb()}if(2&e){const e=a.ic(2);a.Bb(4),a.Kc("Station: ",e.relevesPolluants[0].nomStation,""),a.Bb(2),a.Kc("Commune: ",e.relevesPolluants[0].nomCommune,""),a.Bb(17),a.Jc(e.relevesMeteo.tempatureSol),a.Bb(2),a.Jc(e.relevesMeteo.cumulPluie),a.Bb(2),a.Kc("",e.relevesMeteo.vitesseMoyVent," km/h "),a.Bb(2),a.Jc(a.lc(30,6,e.relevesMeteo.date,"d MMM YYYY"))}}function F(e,t){if(1&e){const e=a.Vb();a.Sb(0),a.Ub(1,"mat-tab-group"),a.Ub(2,"mat-tab",1),a.Ub(3,"mat-card",2),a.Ub(4,"mat-card-header"),a.Ub(5,"mat-card-title"),a.Ic(6),a.Tb(),a.Ub(7,"mat-card-subtitle"),a.Ic(8),a.Tb(),a.Tb(),a.Ub(9,"mat-card-content"),a.Ub(10,"table",3),a.Ub(11,"thead"),a.Ub(12,"tr"),a.Ub(13,"th",4),a.Ic(14,"#"),a.Tb(),a.Ub(15,"th",4),a.Ic(16,"Nom"),a.Tb(),a.Ub(17,"th",4),a.Ic(18,"Valeur"),a.Tb(),a.Ub(19,"th",4),a.Ic(20,"Date d\xe9but"),a.Tb(),a.Ub(21,"th",4),a.Ic(22,"Date fin"),a.Tb(),a.Tb(),a.Tb(),a.Ub(23,"tbody"),a.Gc(24,O,16,19,"ng-container",5),a.Tb(),a.Tb(),a.Tb(),a.Ub(25,"mat-card-actions"),a.Ub(26,"button",6),a.ec("click",function(){return a.yc(e),a.ic().openHistorique()}),a.Ic(27,"Voir l'historique des informations"),a.Tb(),a.Gc(28,D,2,0,"button",7),a.Tb(),a.Tb(),a.Tb(),a.Ub(29,"mat-tab",8),a.Gc(30,B,36,9,"ng-container",0),a.Tb(),a.Tb(),a.Rb()}if(2&e){const e=a.ic();a.Bb(6),a.Kc("Station: ",e.relevesPolluants[0].nomStation,""),a.Bb(2),a.Kc("Commune: ",e.relevesPolluants[0].nomCommune,""),a.Bb(16),a.oc("ngForOf",e.relevesPolluants),a.Bb(4),a.oc("ngIf",e.connected),a.Bb(1),a.oc("disabled",e.noDataMeteo),a.Bb(1),a.oc("ngIf",null!=e.relevesMeteo)}}let w=(()=>{class e{constructor(e,t,o){this.mapService=e,this.dialog=t,this.authServ=o,this.relevesPolluants=[],this.displayedColumns=["nom","valeur","dateDebut","dateFin"],this.columnsToDisplay=this.displayedColumns.slice(),this.noDataMeteo=!0}ngOnInit(){this.subscribeToPolluant(),this.subscribeToMeteo(),this.authServ.utilisateurConnecteObs.subscribe(e=>{console.log("ICIIIII ",e),e.estAnonyme()||(console.log("IL N EST PAS ANONYME ",e),this.connected=!0)},e=>{console.log(e)})}subscribeToPolluant(){this.mapService.onPolluant().subscribe(e=>this.relevesPolluants=e,e=>console.log("erreur ",e))}subscribeToMeteo(){this.mapService.onMeteo().subscribe(e=>{this.relevesMeteo=new P(e),this.noDataMeteo=!1},e=>{console.log("erreur ",e),this.noDataMeteo=!0})}openFavoris(){this.dialog.open(T).afterClosed().subscribe(e=>{console.log("Dialog result: "+e)})}openHistorique(){this.dialog.open(k,{width:"70%"}).afterClosed().subscribe(e=>{console.log("Dialog result: "+e)})}}return e.\u0275fac=function(t){return new(t||e)(a.Ob(l.a),a.Ob(I.a),a.Ob(U.a))},e.\u0275cmp=a.Ib({type:e,selectors:[["app-auth"]],decls:1,vars:1,consts:[[4,"ngIf"],["label","Pollution"],[1,"example-card",2,"height","100%"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","warn",3,"click",4,"ngIf"],["label","M\xe9t\xe9o",3,"disabled"],["scope","row"]],template:function(e,t){1&e&&a.Gc(0,F,31,6,"ng-container",0),2&e&&a.oc("ngIf",0!=t.relevesPolluants.length)},directives:[r.m,M.b,M.a,y.a,y.d,y.g,y.f,y.c,r.l,y.b,f.a],pipes:[r.e],styles:[""]}),e})();var E=o("3sZV"),q=o("lJxs");class x{constructor(e){Object.assign(this,e)}}var A=o("Xa2L");function G(e,t){if(1&e){const e=a.Vb();a.Ub(0,"map-marker",8,9),a.ec("mapClick",function(){a.yc(e);const o=t.$implicit;return a.ic(2).clickMarker(o)}),a.Tb()}if(2&e){const e=t.$implicit;a.oc("position",e.position)("label",e.label)("title",e.title)("options",e.options)}}function H(e,t){if(1&e){const e=a.Vb();a.Ub(0,"div",2),a.Ub(1,"div",3),a.Ub(2,"div",4),a.Ub(3,"google-map",5),a.ec("mapClick",function(t){return a.yc(e),a.ic().click(t)}),a.Gc(4,G,2,4,"map-marker",6),a.Tb(),a.Tb(),a.Ub(5,"div",7),a.Pb(6,"router-outlet"),a.Tb(),a.Tb(),a.Tb()}if(2&e){const e=a.ic();a.Bb(3),a.oc("center",e.myCenter)("zoom",e.myZoom),a.Bb(1),a.oc("ngForOf",e.markers)}}function J(e,t){1&e&&(a.Ub(0,"div",10),a.Pb(1,"mat-spinner",11),a.Tb())}const N=[{path:"",component:(()=>{class e{constructor(e,t,o){this.authServ=e,this.mapService=t,this.router=o,this.myCenter={lat:43.6600980666535,lng:3.035913988993468},this.myZoom=8,this.markers=[],this.stations=[],this.markerLoaded=!1,this.connected=!1,this.clicked=!1,this.authServ.utilisateurConnecteObs.subscribe(e=>{e.estAnonyme()||(this.connected=!0)},e=>{console.log(e)})}ngOnInit(){this.addMarker().subscribe(e=>{this.stations.forEach(e=>{this.markers.push({position:{lat:e.latitude,lng:e.longitude},label:{color:"white",idStation:e.id,idCommune:e.communeId,nomCommune:e.nomCommune},title:"Station pollution"})}),this.markerLoaded=!0,console.log("Markers initilialis\xe9s")},e=>console.log(e)),this.subscription=this.mapService.recupererSearchedCommune().subscribe(e=>{console.log("Reception Commubne cot\xe9 MAP"),this.communeSelected=e,this.centrerCamOnSearch(),this.myZoom=11})}ngOnDestroy(){this.subscription.unsubscribe()}click(e){console.log(e)}addMarker(){return this.mapService.getAllStation().pipe(Object(q.a)(e=>(e.forEach(e=>{this.stations.push(new x(e))}),this.stations)))}clickMarker(e,t){localStorage.removeItem("commune"),this.getPolluantAndEmit(e),this.getMeteoByCommuneAndEmit(e);let o=this.formatInfoCommuneToStorage(e);localStorage.setItem("commune",o),this.router.navigate(["map/listeReleve"])}getPolluantAndEmit(e){this.mapService.getPolluantsByStation(e.label.idStation).subscribe(e=>{this.clicked=!0,this.mapService.emitPolluant(e)},e=>console.log(e))}getMeteoByCommuneAndEmit(e){this.mapService.getMeteoByCommune(e.label.idCommune).subscribe(e=>{this.clicked=!0,this.mapService.emitMeteo(e)},e=>console.log(e))}formatInfoCommuneToStorage(e){return JSON.stringify({idCommune:e.label.idCommune,nomCommune:e.label.nomCommune})}centrerCamOnSearch(){this.myCenter={lat:this.communeSelected.centre.coordinates[1],lng:this.communeSelected.centre.coordinates[0]}}}return e.\u0275fac=function(t){return new(t||e)(a.Ob(U.a),a.Ob(l.a),a.Ob(i.c))},e.\u0275cmp=a.Ib({type:e,selectors:[["app-map"]],viewQuery:function(e,t){if(1&e&&a.Mc(E.c,!0),2&e){let e;a.vc(e=a.fc())&&(t.infoWindow=e.first)}},decls:2,vars:2,consts:[["class","container-fluid",4,"ngIf"],["class","container",4,"ngIf"],[1,"container-fluid"],[1,"row"],[1,"col-7"],["height","675","width","100%",3,"center","zoom","mapClick"],[3,"position","label","title","options","mapClick",4,"ngFor","ngForOf"],[1,"col-5"],[3,"position","label","title","options","mapClick"],["marker",""],[1,"container"],["color","warn",1,"m-auto"]],template:function(e,t){1&e&&(a.Gc(0,H,7,3,"div",0),a.Gc(1,J,2,0,"div",1)),2&e&&(a.oc("ngIf",t.markerLoaded),a.Bb(1),a.oc("ngIf",!t.markerLoaded))},directives:[r.m,E.a,r.l,i.f,E.d,A.b],styles:[".col-7[_ngcontent-%COMP%]{padding-left:0}"]}),e})(),children:[{path:"listeReleve",component:w},{path:"historique",component:k},{path:"create",component:T},{path:"**",redirectTo:"listeReleve"}]},{path:"**",redirectTo:""}];let V=(()=>{class e{}return e.\u0275mod=a.Mb({type:e}),e.\u0275inj=a.Lb({factory:function(t){return new(t||e)},imports:[[i.e.forChild(N)],i.e]}),e})();var j=o("PCNd");let Y=(()=>{class e{}return e.\u0275mod=a.Mb({type:e}),e.\u0275inj=a.Lb({factory:function(t){return new(t||e)},providers:[l.a,u],imports:[[r.c,V,E.b,j.a,c.h,i.e]]}),e})()}}]);